using System;
using System.Collections.Generic;

namespace oopTask4
{
    internal class Program
    {
        static void Main(string[] args)
        {
            const string TakeCardFromDeckCommand = "1";
            const string ShowCardsInHandCommand = "2";
            const string FinishDrawingCardsCommand = "3";
            const string MixCardsInDeckCommand = "4";
            const string ShowCardsInDeckCommand = "5";

            Deck cardList = new Deck();
            Player player = new Player();
            bool isWorking = true;

            while (isWorking)
            {
                Console.WriteLine($"Вы можете выполнить одну из следующих команд:\n" +
                    $"{TakeCardFromDeckCommand} - взять карту из колоды\n" +
                    $"{ShowCardsInHandCommand} - показать карты в вашей руке\n" +
                    $"{FinishDrawingCardsCommand} - закончить набор карт\n" +
                    $"{MixCardsInDeckCommand} - перемешать карты в колоде\n" +
                    $"{ShowCardsInDeckCommand} - показать карты в колоде\n");
                string userInput = Console.ReadLine();
                Console.Clear();
                
                switch (userInput)
                {
                    case TakeCardFromDeckCommand:
                        player.TakeCardFromDeck(cardList);
                        break;

                    case ShowCardsInHandCommand:
                        player.ShowCardsInHand();
                        break;

                    case FinishDrawingCardsCommand:
                        player.FinishDrawingCards(out isWorking);
                        break;

                    case MixCardsInDeckCommand:
                        cardList.MixCardsInDeck(player);
                        break;

                    case ShowCardsInDeckCommand:
                        cardList.ShowCardsInDeck(player);
                        break;

                    default:
                        player.WriteWrongInputMessage();
                        break;

                }
                
                Console.Clear();
            }
        }
    }

    public class Card
    {
        public Card(string suit, string value)
        {
            Suit = suit;
            Value = value;
        }

        public string Suit { get; private set; }
        public string Value { get; private set; }
    }

    public class Deck
    {
        private List<Card> _cardsInDeck = new List<Card> { new Card("Черви", "Король"), new Card("Черви", "Дама"), new Card("Крести", "6"), new Card("Крести", "8") };

        public void ShowCardsInDeck(Player player)
        {
            for (int i = 0; i < _cardsInDeck.Count; i++)
                Console.WriteLine($"{_cardsInDeck[i].Suit}, {_cardsInDeck[i].Value}\n");

            player.PressAnyKeyForContinue();
        }

        public Card DrawCardFromDeck()
        {
            Random random = new Random();
            int randomCardIndex = random.Next(0, _cardsInDeck.Count);
            Card takenCard = _cardsInDeck[randomCardIndex];
            _cardsInDeck.Remove(takenCard);
            return takenCard;
        }

        public void MixCardsInDeck(Player player)
        {
            Random random = new Random();

            for (int i = _cardsInDeck.Count - 1; i >= 1; i--)
            {
                int j = random.Next(i + 1);
                (_cardsInDeck[i], _cardsInDeck[j]) = (_cardsInDeck[j], _cardsInDeck[i]);
            }

            Console.WriteLine("Карты перемешаны");
            player.PressAnyKeyForContinue();
        }
    }

    public class Player
    {
        private List<Card> _cardsInHand = new List<Card>();

        public void TakeCardFromDeck(Deck deck)
        {
            int maxCardsInHandCount = 3;

            if (_cardsInHand.Count < maxCardsInHandCount)
            {
                _cardsInHand.Add(deck.DrawCardFromDeck());
                Console.WriteLine($"Вы взяли из колоды карту, теперь в вашей руке карт: {_cardsInHand.Count}.");
            }
            else
            {
                Console.WriteLine("В вашей руке уже достаточно карт.");
            }

            PressAnyKeyForContinue();
        }

        public void ShowCardsInHand()
        {
            if (_cardsInHand.Count > 0)
            {
                for (int i = 0; i < _cardsInHand.Count; i++)
                    Console.WriteLine($"{_cardsInHand[i].Suit}, {_cardsInHand[i].Value}\n");
            }
            else
            {
                Console.WriteLine("В вашей руке нет ни одной карты");
            }

            PressAnyKeyForContinue();
        }

        public void FinishDrawingCards(out bool isWorking)
        {
            Console.WriteLine("Вы закончили набор карт. В вашей руке следующие карты:\n");
            ShowCardsInHand();
            isWorking = false;
        }

        public void WriteWrongInputMessage()
        {
            Console.WriteLine("Введеная неверная команда");
            PressAnyKeyForContinue();
        }

        public void PressAnyKeyForContinue()
        {
            Console.WriteLine("\nНажмите любую клавишу, чтобы продолжить...");
            Console.ReadKey();
        }
    }
}
